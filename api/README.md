# Cutting Optimizer API — Оптимизатор раскроя материалов

## О проекте

Backend-сервис для автоматической оптимизации раскроя металла, ДСП, стекла, ткани и других листовых материалов.
Сервис умеет максимально плотно размещать детали на листах или рулонах, минимизировать отходы, разбивать слишком длинные детали, учитывать поворот, цвет, толщину и ограничения станка (макс. 3000 × 3000 мм).
Готов к использованию в реальном производстве или интеграции в ERP/CRM-системы.
Работает в паре с фронтендом на Next.js 15 (отдельный репозиторий).

## Технологии и инструменты

| Категория        | Технология                          | Назначение                                         |
| ---------------- | ----------------------------------- | -------------------------------------------------- |
| Фреймворк        | NestJS 11+                          | Чистая модульная архитектура, DI, масштабируемость |
| Язык             | TypeScript (strict mode)            | Типобезопасность                                   |
| Валидация        | class-validator + class-transformer | Надёжная проверка данных + автогенерация Swagger   |
| Алгоритм         | maxrects-packer                     | Быстрая 2D-упаковка                                |
| Документация API | @nestjs/swagger (OpenAPI 3)         | Интерактивная документация                         |
| Форматирование   | ESLint + Prettier                   | Единый стиль кода                                  |
| Логирование      | Собственный модуль logger           | Структурированные логи с контекстом                |

## Основные возможности

- Получение JSON-запроса с массивом деталей, доступными материалами (опционально) и настройками оптимизации
- Группировка деталей по цвету и толщине
- Автоматическое разбиение деталей длиннее 3000 мм на сегменты
- Поддержка бесконечных рулонов
- Умная упаковка с помощью MaxRectsPacker (поворот, smart-режим)
- Расчёт отходов, коэффициента использования, неразмещённых деталей с указанием причины
- Полный ответ с координатами размещения и статистикой

Единственный эндпоинт:  
`POST /api/optimizer`

## Структура проекта

```
src
 ┣ auth/                              # Модуль аутентификации
 ┣ logger/                            # Кастомный логгер
 ┣ optimizer
 ┃ ┣ dto/                             # Классы-DTO (для Swagger и class-validator)
 ┃ ┣ cutting-optimizer.spec.ts
 ┃ ┣ cutting-optimizer.ts             # Основная бизнес-логика (паковка, разбиение и т.д.)
 ┃ ┣ optimizer.controller.ts
 ┃ ┣ optimizer.module.ts
 ┃ ┣ optimizer.service.spec.ts
 ┃ ┗ optimizer.service.ts
 ┣ shared/
 ┃ ┣ constants.ts                     # Ограничения станка, ширина рулона и т.д.
 ┃ ┣ types.ts                         # Внутренние типы
 ┃ ┗ utils.ts
 ┣ app.module.ts
 ┗ main.ts
```

## Запуск

```bash
# 1. Перейти в директорию API сервиса
cd api

# 2. Установить зависимости
npm install

# 3. Скопировать `.env.example` в `.env`:
cp .env.example .env

# 4. Запустить в режиме разработки
npm run start:dev

# 5. Открыть документацию
http://localhost:3010/api
```

## Пример запроса

```json
{
  "parts": [
    {
      "id": "1",
      "length": 2500,
      "width": 150,
      "color": "9003",
      "thickness": 0.45,
      "quantity": 4,
      "canRotate": true,
      "label": "",
      "description": "Конек"
    },
    {
      "id": "2",
      "length": 2500,
      "width": 542,
      "color": "9003",
      "thickness": 0.45,
      "quantity": 2,
      "canRotate": true,
      "label": "",
      "description": "Угол наружный сложный"
    }
  ],
  "options": {
    "minWaste": true,
    "maxUtilization": true,
    "smartPack": true,
    "useInfiniteMaterials": true
  }
}
```

Ответ содержит размещённые листы, отходы, процент использования и список неразмещённых деталей (если есть).

## Особенности реализации

1. Полностью типизированный код на TypeScript
2. Чистая модульная архитектура NestJS
3. Безопасность входных данных (class-validator)
4. Детальная OpenAPI-документация с примерами запросов
5. Легко расширяемая структура

## Планы развития

- Docker + docker-compose
- Более продвинутые алгоритмы
